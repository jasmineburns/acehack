<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="The blog of Saksham Sharma">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <title>AceHack - ZSH globbing to play music</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,large&amp;lang=en">
    <link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.grey-pink.min.css" />
    <link rel="stylesheet" href="../css/styles.css" />
    <link rel="stylesheet" href="../css/footer.css" />

    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="../js/fb.js"></script>
  </head>
  <body>

    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <header class="mdl-layout__header mdl-layout__header--scroll portfolio-header">
        <div class="mdl-layout__header-row portfolio-logo-row">
          <span class="mdl-layout__title">
            <a href="../">
              <div class="portfolio-logo"></div>
            </a>
            <span class="mdl-layout__title">The blog of Saksham Sharma</span>
          </span>
        </div>
        <div class="mdl-layout__header-row portfolio-navigation-row mdl-layout--large-screen-only">
          <nav class="mdl-navigation mdl-typography--body-1-force-preferred-font">
            <a class="mdl-navigation__link mynav" href="../index.html">Home</a>
            <a class="mdl-navigation__link mynav" href="../archive.html">Blog</a>
            <a class="mdl-navigation__link mynav" href="../about.html">About</a>
          </nav>
        </div>
      </header>
      <div class="mdl-layout__drawer mdl-layout--small-screen-only">
        <nav class="mdl-navigation mdl-typography--body-1-force-preferred-font">
          <a class="mdl-navigation__link mynav" href="../index.html">Home</a>
          <a class="mdl-navigation__link mynav" href="../archive.html">Blog</a>
          <a class="mdl-navigation__link mynav" href="../about.html">About</a>
        </nav>
      </div>
      <main class="mdl-layout__content">
        <div class="con-body">
          <div class="mdl-grid">
  <div class="mdl-cell mdl-cell--3-col"></div>
  <div class="mdl-cell mdl-cell--6-col mdl-cell--4-cell-phonemdl-card mdl-shadow--4dp">
    <div class="mdl-card__title">
      <h1 class="mdl-card__title-text" style="font-size: 2.5em;">ZSH globbing to play music</h1>
    </div>
    
    <div class="mdl-card__supporting-text">
      <strong>Written on: </strong> October 29, 2016
      <strong>by</strong> Saksham Sharma 
      <br><strong>Tags: </strong> <a href="../tags/shell.html">shell</a>, <a href="../tags/zsh.html">zsh</a>, <a href="../tags/linux.html">linux</a>, <a href="../tags/music.html">music</a> <br>
    </div>
    <div class="mdl-grid portfolio-copy" style="max-width: 95%;">
      <div class="mdl-cell mdl-cell--12-col mdl-cell--4-col-phone mdl-card__supporting-text no-padding">
        <div class="con-body">
          <p>Too lazy to learn to use the awesome <a href="https://cmus.github.io/">cmus</a>, and living on an (very regrettably) extremely unorganized music library since I came to IIT Kanpur, yeah that’s me these days when it comes to music. Without the likes of Spotify in India, I’ve been living on YouTube since more than 2 years, when I used to have a fully organized music library back in my school days.</p>
<p>Having a very dynamic (and mostly incomplete) music library, I was constantly being annoyed having to import folders, sort some, organize others. What would be ideal in such a scenario is a way to live in the shell itself, but have the freedom to easily search for music files and play them.</p>
<p>If you’re not familiar with pattern globbing, fire up ZSH and try this:</p>
<pre><code>cd Pictures
ls **/*.jpg</code></pre>
<p>Nice right? The <code>**</code> stands for recursive searching. So it will go and search recursively in all subfolders of the current directory.</p>
<h3 id="zsh-play">zsh-play</h3>
<p>I envisioned an interface of this sort:</p>
<pre><code>play river flows</code></pre>
<p>This ought to open all songs containing the words <em>river</em> and <em>flows</em> in their name, in this particular order, regardless of the case of the spellings. Also, it shouldn’t be matching all kinds of files, so I added a <code>-t</code> flag, to decide the file type, set to <code>mp3</code> by default, but something like <code>-t flac</code> works as well.</p>
<h3 id="how-to">How to?</h3>
<p>The code was short enough. I added a new ZSH function in my ZSH configuration, and voila! In reality though, it took me a great while to make it work, because I did not know (sounds obvious in hindsight as always) that globs (The useful <code>*</code>s) are not expanded when coming from a string variable in the shell. And why should they?</p>
<p>You can pick the code from the end of this article, and use it by putting it in your .zshrc and sourcing it. Voila!</p>
<h3 id="lessons">Lessons</h3>
<ul>
<li>Globs aren’t expanded from strings. Don’t hope to put strings containing <code>*</code>s in a command, and expect it to expand. Use <code>{~var}</code> instead.</li>
<li>Functions in ZSH are quite powerful! Better use them instead of writing aliases and small scripts.</li>
<li><code>getopts</code> and <code>OPTARGS</code> is a really nice way to implement CLI arguments!</li>
<li>You need <code>setopt extendedglob</code> for some globbing to work.</li>
<li>Case insensitive matching of globs uses <code>(#i)</code>.</li>
<li>You can generate array of names of files very easily with <code>list=(**/*.mp3)</code> kind of syntax.</li>
</ul>
<h3 id="the-code">The code:</h3>
<pre><code>    function play() {
    EXT=&quot;mp3&quot;
    while getopts “ht:r:p:v” OPTION
    do
        case $OPTION in
            t)
                EXT=$OPTARG
                echo &quot;$EXT extension&quot;
                shift 2
                ;;
            ?)
            usage
            ;;
    esac
done

setopt extendedglob
pat=$(echo -n &quot;$@&quot; | sed -E 's/\s+/\*/g')
list=((#i)**/*${~pat}*.${EXT})
vlc $list
}</code></pre>
        </div>
        <div class="fb-like" data-share="true" data-width="450" data-show-faces="true">
        </div>
        <!-- <div -->
        <!--   class="fb-comments" -->
        <!--   data-href="http://www.acehack.org/posts/2016-10-29-cliplay.html" -->
        <!--   data-numposts="20" -->
        <!--   data-width="100%"> -->
        <!-- </div> -->

        <script id="dsq-count-scr" src="//acehack.disqus.com/count.js" async></script>

        <div id="disqus_thread"></div>
        <script>
          // For debugging
          var disqus_developer = 1;
          var disqus_shortname = 'acehack';
          var disqus_config = function () {
          this.page.url = 'http://acehack.org/posts/2016-10-29-cliplay.html';
          this.page.identifier = 'zsh-play';
          this.page.title = 'ZSH globbing to play music';
          };
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
          (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
          }());
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


      </div>
    </div>
  </div>

</div>

        </div>
      <footer class="mdl-mini-footer">
        <div class="mdl-mini-footer__left-section">
          <div class="mdl-logo">
            <h5 style="color: #bbbbbb; margin: 0; padding: 0;">AceHack</h5>
            <p style="color: #aaaaaa; margin: 0; margin-top: 5px; padding: 0;">The blog of Saksham Sharma</p>
            <p style="color: #aaaaaa; margin: 0; margin-top: 5px; padding: 0;">Hosted on Github <a href="https://github.com/sakshamsharma/acehack" target="_blank">here</a><p>
          </div>
        </div>
        <div class="mdl-mini-footer__middle-section">
          <div class="mdl-logo" style="text-align: right;">
            <a href="https://github.com/sakshamsharma" target="_blank">sakshamsharma</a>@github<br>
            <a href="mailto:saksham@acehack.org" target="_blank">saksham@acehack.com</a>
          </div>
        </div>
        <div class="mdl-mini-footer__right-section">
          <div class="mdl-logo">Proudly generated by Hakyll</div>
        </div>
      </footer>
      </main>
    </div>
    <script src="https://code.getmdl.io/1.1.3/material.min.js"></script>
    <script>
var links = document.getElementsByClassName('mynav');
for(i=0;i<links.length;i++) {
  var tmp = links[i].href;
  if (tmp.substring(tmp.lastIndexOf('/')) == document.location.pathname) {
    links[i].className += " is-active"
  }
}
    </script>
  </body>
</html>
